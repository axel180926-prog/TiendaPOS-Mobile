# CLAUDE.MD - TiendaPOS Mobile

> Context file for Claude AI assistant sessions
> Last Updated: 2026-01-13

## ğŸ¯ Project Overview

**TiendaPOS Mobile** is a React Native point-of-sale (POS) application built with Expo for small Mexican retail stores. This is a mobile counterpart to an existing Electron desktop application.

### Key Facts
- **Platform:** React Native + Expo SDK 54
- **Database:** SQLite with Drizzle ORM
- **State Management:** Zustand
- **UI Framework:** React Native Paper
- **Navigation:** Expo Router (migrating to React Navigation Drawer)
- **Target Market:** Mexican convenience stores (tiendas de abarrotes)

---

## ğŸ“‚ Project Structure

```
TiendaPOS-Mobile/
â”œâ”€â”€ app/                          # Expo Router screens
â”‚   â”œâ”€â”€ (tabs)/                   # Tab-based navigation
â”‚   â”‚   â””â”€â”€ index.tsx             # âœ… Main POS screen (complete)
â”‚   â”œâ”€â”€ (drawer)/                 # ğŸš§ Drawer navigation (in progress)
â”‚   â””â”€â”€ _layout.tsx               # App initialization & DB setup
â”‚
â”œâ”€â”€ lib/                          # Core application logic
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ schema.ts             # âœ… Database schema (9 tables)
â”‚   â”‚   â”œâ”€â”€ index.ts              # ğŸš§ DB initialization (needs update)
â”‚   â”‚   â””â”€â”€ queries.ts            # ğŸš§ Data queries (needs update)
â”‚   â”‚
â”‚   â”œâ”€â”€ bluetooth/
â”‚   â”‚   â”œâ”€â”€ scanner.ts            # âœ… Barcode scanner hook
â”‚   â”‚   â””â”€â”€ printer.ts            # âœ… Thermal printer system
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                    # Zustand state management
â”‚   â”‚   â”œâ”€â”€ useCartStore.ts       # âœ… Shopping cart
â”‚   â”‚   â”œâ”€â”€ useProductStore.ts    # âœ… Product management
â”‚   â”‚   â””â”€â”€ useConfigStore.ts     # âœ… App configuration
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ formatters.ts         # âœ… Currency, dates, etc.
â”‚       â””â”€â”€ seedData.ts           # ğŸš§ Initial data loader (needs update)
â”‚
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ productos/
â”‚       â””â”€â”€ productos-mexico.json # âœ… 40 pre-loaded Mexican products
â”‚
â”œâ”€â”€ INSTRUCCIONES-PRUEBA.md      # Testing instructions
â”œâ”€â”€ PLAN-MIGRACION-COMPLETO.md   # Migration plan
â”œâ”€â”€ RESUMEN-PROYECTO.md          # Project summary
â””â”€â”€ RESUMEN-ANALISIS-COMPLETO.md # Complete analysis
```

---

## ğŸ—„ï¸ Database Schema

### Tables (9 total)

1. **productos** - Product catalog
   - Fields: codigo_barras, nombre, precio, stock, categoria, marca, presentacion, descripcion, sku, unidad_medida
   - Pre-loaded: 40 Mexican products

2. **ventas** - Sales records
   - Fields: total, fecha, metodo_pago, caja_id
   - Simplified structure (no IVA breakdown)

3. **venta_items** - Sale line items
   - Fields: venta_id, producto_id, cantidad, precio_unitario

4. **cajas** - Cash register sessions
   - Fields: monto_inicial, monto_final, fecha_apertura, fecha_cierre, usuario_apertura

5. **movimientos_caja** - Cash movements
   - Fields: caja_id, tipo, monto, concepto, fecha, usuario

6. **proveedores** - Supplier management
   - Fields: nombre, contacto, telefono, email, direccion, rfc

7. **productos_proveedores** - Product-supplier relationship
   - Many-to-many linking table

8. **lista_compras** - Shopping/reorder list
   - Fields: producto_id, cantidad_sugerida, fecha_agregado

9. **configuracion** - App settings
   - 40+ configuration fields for store customization

---

## ğŸš¨ Critical Issues & Status

### ğŸ”´ URGENT - Database Schema Mismatch

**Problem:** Mobile app currently uses OLD schema, different from desktop app.

**Old Schema (currently in code):**
- productos: precio_compra, precio_venta, stock_minimo
- ventas: folio, subtotal, iva, descuento, forma_pago, monto_recibido, cambio
- detalle_ventas: (old table name)

**New Schema (needed):**
- productos: precio (single field), marca, presentacion, sku
- ventas: total, metodo_pago, caja_id
- venta_items: (new table name)

**Status:**
- âœ… schema.ts updated
- âŒ index.ts needs update (still creates old tables)
- âŒ queries.ts needs complete rewrite
- âŒ productos-mexico.json needs update (remove precio_compra/precio_venta)
- âŒ POS screen needs update to use new structure

---

## âœ… Completed Features (70%)

### 1. Point of Sale (POS) - 95% Complete
- âœ… Product search in real-time
- âœ… Barcode scanning (Bluetooth HID)
- âœ… Shopping cart with quantity adjustment
- âœ… Stock validation
- âœ… Multiple payment methods (cash, card, transfer)
- âœ… Change calculation
- âœ… Automatic IVA calculation (16%)
- âœ… PDF ticket generation
- âŒ Integration with cash register (caja) - PENDING

### 2. Database & Data
- âœ… SQLite setup with Drizzle ORM
- âœ… Schema defined (9 tables)
- âœ… 40 Mexican products pre-loaded
- âŒ Database initialization outdated
- âŒ Queries need updating

### 3. Hardware Integration
- âœ… Bluetooth barcode scanner (HID input)
- âœ… Thermal printer (PDF generation)
- âš ï¸ Real Bluetooth printing requires bare workflow

### 4. UI/UX
- âœ… React Native Paper components
- âœ… Professional POS interface
- âœ… Responsive design
- âŒ Navigation incomplete (no drawer/tabs)

---

## ğŸš§ Pending Features (30%)

### Priority HIGH (Week 1-2)

1. **Fix Database Incompatibilities** ğŸ”´ CRITICAL
   - Update index.ts initialization
   - Update all queries.ts functions
   - Update productos-mexico.json format
   - Create migration script

2. **Complete Navigation** ğŸ”´ URGENT
   - Implement Drawer Navigator
   - Setup Bottom Tabs
   - Connect screens

3. **Product Management Module** ğŸ”´ URGENT
   - Product list with search/filters
   - Add/Edit product forms
   - Category management
   - Import/Export

4. **Cash Register Module** ğŸŸ¡ IMPORTANT
   - Open cash register (apertura de caja)
   - Record movements
   - Cash withdrawals
   - Close register
   - History

5. **Update POS Screen** ğŸŸ¡ IMPORTANT
   - Link to active cash register
   - Use new sales structure
   - Update queries

### Priority MEDIUM (Week 3-4)

6. **Inventory Module**
   - Stock view
   - Low stock alerts
   - Inventory adjustments
   - Reorder list

7. **Suppliers Module**
   - Supplier CRUD
   - Link to products
   - Purchase recording

8. **Sales History**
   - Complete list with filters
   - Sale details
   - Reprint tickets

9. **Basic Reports**
   - Sales by period
   - Top products
   - Simple charts

10. **Settings**
    - Store information
    - POS preferences
    - Printer configuration

### Priority LOW (Week 5+)

11. Virtual assistant (optional)
12. Product catalog view
13. Advanced financial reports
14. Cloud sync
15. Push notifications

---

## ğŸ› ï¸ Technology Stack

### Dependencies

**Core:**
- expo: ~54.0.0
- react-native: 0.74.0
- expo-router: ~3.5.0
- typescript: ^5.3.0

**Database:**
- expo-sqlite: ~14.0.0
- drizzle-orm: ^0.33.0

**UI:**
- react-native-paper: ^5.12.0
- react-native-safe-area-context
- @expo/vector-icons

**State:**
- zustand: ^4.5.0
- react-hook-form: ^7.51.0
- zod: ^3.23.0

**Utilities:**
- date-fns: ^3.0.0

**Hardware:**
- expo-barcode-scanner: ~13.0.0
- expo-print: ~13.0.0
- expo-sharing: ~12.0.0
- expo-file-system: ~17.0.0

---

## ğŸ“ Coding Guidelines

### File Operations
- ALWAYS prefer editing existing files over creating new ones
- NEVER create markdown files unless explicitly requested
- Use Read tool before Edit/Write operations

### Code Style
- TypeScript strict mode
- Functional components with hooks
- Clear variable/function names in Spanish (matching domain)
- Minimal comments (self-documenting code preferred)

### Database
- Use Drizzle ORM for all queries
- Always use transactions for multi-step operations
- Validate data with Zod schemas
- Handle SQLite errors gracefully

### State Management
- Zustand for global state
- React Hook Form for forms
- Keep stores focused and minimal

### UI/UX
- React Native Paper for consistency
- Safe area handling
- Responsive to different screen sizes
- Loading states and error handling

---

## ğŸ¯ Current Sprint Focus

### Immediate Tasks (This Week)

1. âœ… Update CLAUDE.MD (this file)
2. ğŸš§ Fix database schema incompatibilities
   - Update lib/database/index.ts
   - Update lib/database/queries.ts
   - Update assets/productos/productos-mexico.json
3. ğŸš§ Implement navigation structure
4. ğŸš§ Create product management module

---

## ğŸ’¡ Important Context

### Desktop App Reference
There's a companion Electron desktop app at `C:\Users\gaele\pos-tienda` with:
- 12 complete modules
- Same database schema (our target)
- Advanced features (financial reports, AI assistant)

**Goal:** Mobile app should match desktop functionality for offline stores.

### Business Context
- Target: Small Mexican retail stores
- Need: Offline-first POS system
- Hardware: Bluetooth scanner + thermal printer
- Users: Store owners with basic tech skills

### Technical Constraints
- Must work offline (no internet required)
- SQLite for data persistence
- No backend/cloud (for now)
- Expo for rapid development
- May need bare workflow for full Bluetooth printing

---

## ğŸ“ Getting Help

- Issues: https://github.com/anthropics/claude-code/issues
- Command: /help for Claude Code assistance

---

## ğŸ”„ Session Continuity

### For Next Session

**Current State:**
- Schema updated in schema.ts
- 40 products ready in JSON
- POS screen functional but using old schema
- No navigation structure yet

**Immediate Priorities:**
1. Fix database initialization (index.ts)
2. Update all queries (queries.ts)
3. Implement drawer navigation
4. Create product list screen

**Blocked By:**
- Database schema mismatch must be fixed first
- Navigation needed before adding more screens

---

## ğŸ“Š Progress Metrics

- Overall: 70% complete
- Database: 60% (schema âœ…, init âŒ, queries âŒ)
- POS: 95% (works but needs schema update)
- Products: 10% (data âœ…, UI âŒ)
- Navigation: 20% (basic routing only)
- Reports: 0%
- Settings: 0%

**Estimated to v1.0:** 4-5 weeks

---

*This file should be read at the start of each Claude session for full context.*
